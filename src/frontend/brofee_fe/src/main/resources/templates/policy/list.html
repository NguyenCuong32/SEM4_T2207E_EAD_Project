<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
	<!--begin::Head-->
	<head>
		<title>Metronic - the world's #1 selling Bootstrap Admin Theme Ecosystem for HTML, Vue, React, Angular &amp; Laravel by Keenthemes</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta property="og:locale" content="en_US" />
		<meta property="og:type" content="article" />
		<meta property="og:title" content="Metronic - Bootstrap 5 HTML, VueJS, React, Angular &amp; Laravel Admin Dashboard Theme" />
		<meta property="og:url" content="https://keenthemes.com/metronic" />
		<meta property="og:site_name" content="Keenthemes | Metronic" />
		<link rel="canonical" href="https://preview.keenthemes.com/metronic8" />
		<link rel="shortcut icon" th:href="@{/media/logos/favicon.ico}" />
		<!--begin::Fonts-->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
		<!--end::Fonts-->
		<!--begin::Page Vendor Stylesheets(used by this page)-->
		<link th:href="@{/plugins/custom/datatables/datatables.bundle.css}" rel="stylesheet" type="text/css" />
		<link th:href="@{/plugins/custom/vis-timeline/vis-timeline.bundle.css}" rel="stylesheet" type="text/css" />
		<!--end::Page Vendor Stylesheets-->
		<!--begin::Global Stylesheets Bundle(used by all pages)-->
		<link th:href="@{/plugins/global/plugins.bundle.css}" rel="stylesheet" type="text/css" />
		<link th:href="@{/css/style.bundle.css}" rel="stylesheet" type="text/css" />
		<!--end::Global Stylesheets Bundle-->

		<meta th:name="_csrf" th:content="${_csrf.token}"/>
		<meta th:name="_csrf_header" th:content="${_csrf.headerName}"/>
	</head>
	<!--end::Head-->
	<!--begin::Body-->
	<body id="kt_body" class="header-fixed header-tablet-and-mobile-fixed toolbar-enabled toolbar-fixed aside-enabled aside-fixed" style="--kt-toolbar-height:55px;--kt-toolbar-height-tablet-and-mobile:55px">
		<!--begin::Main-->
		<!--begin::Root-->
		<div class="d-flex flex-column flex-root">
			<!--begin::Page-->
			<div class="page d-flex flex-row flex-column-fluid">
				<!--begin::Aside-->
				<div th:replace="fragments/aside :: aside(menu = 4)"></div>
				<!--end::Aside-->
				<!--begin::Wrapper-->
				<div class="wrapper d-flex flex-column flex-row-fluid" id="kt_wrapper">
					<!--begin::Header-->
					<div th:replace="fragments/header :: header(title = 'Commission Policy')"></div>
					<!--end::Header-->
					<!--begin::Content-->
					<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
						<!--begin::Toolbar-->

						<!--end::Toolbar-->
						<!--begin::Post-->
						<div class="post d-flex flex-column-fluid" id="kt_post">
							<!--begin::Container-->
							<div id="kt_content_container" class="container-xxl">
								<!--begin::Products-->
								<div class="card card-flush">
									<!--begin::Card header-->
									<div class="card-header align-items-center py-5 gap-2 gap-md-5">
										<h3 class="card-title align-items-start flex-column">
											<span class="card-label fw-bolder fs-3 mb-1">Recent Policies</span>
											<span class="text-muted mt-1 fw-bold fs-7">Total 07 policies</span>
										</h3>
										<!--begin::Card toolbar-->
										<div class="card-toolbar flex-row-fluid justify-content-end gap-5">
											<!--begin::Add product-->
											<a th:href="@{/policy/create}" class="btn btn-primary">Add Policy</a>
											<!--end::Add product-->
										</div>
										<!--end::Card toolbar-->
									</div>
									<!--end::Card header-->
									<!--begin::Card body-->
									<div class="card-body pt-0">
										<!--begin::Table-->
										<table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_ecommerce_products_table">
											<!--begin::Table head-->
											<thead>
											<!--begin::Table row-->
											<tr class="text-start text-gray-400 fw-bolder fs-7 text-uppercase gs-0">
												<th class="w-10px pe-2">
													<div class="form-check form-check-sm form-check-custom form-check-solid me-3">
														<input class="form-check-input" type="checkbox" data-kt-check="true" data-kt-check-target="#kt_ecommerce_products_table .form-check-input" value="1" />
													</div>
												</th>
												<th class="min-w-100px">Policy</th>
												<th class="text-end min-w-100px">Start Date</th>
												<th class="text-end min-w-70px">End Date</th>
												<th class="text-end min-w-100px">Services</th>
												<th class="text-end min-w-100px">Commission Rate</th>
												<th class="text-end min-w-100px">Status</th>
												<th class="text-end min-w-70px">Actions</th>
											</tr>
											<!--end::Table row-->
											</thead>
											<!--end::Table head-->
											<!--begin::Table body-->
											<tbody class="fw-bold text-gray-600">
											<!--begin::Table row-->
											<tr th:each="policy : ${policies}">
												<!--begin::Checkbox-->
												<td>
													<div class="form-check form-check-sm form-check-custom form-check-solid">
														<input class="form-check-input" type="checkbox" value="1" />
													</div>
												</td>
												<!--end::Checkbox-->
												<!--begin::Category=-->
												<td>
													<div class="d-flex align-items-center">
														<div class="">
															<!--begin::Title-->
															<a class="text-gray-800 text-hover-primary fs-5 fw-bolder" data-kt-ecommerce-product-filter="product_name" th:text="${policy.code}"></a>
															<!--end::Title-->
														</div>
													</div>
												</td>
												<!--end::Category=-->
												<!--begin::SKU=-->
												<td class="text-end pe-0">
													<span class="fw-bolder" th:text="${#temporals.format(policy.startDate, 'dd MMM, yyyy')}"></span>
												</td>
												<!--end::SKU=-->
												<!--begin::Qty=-->
												<td class="text-end pe-0">
													<span class="fw-bolder ms-3" th:text="${#temporals.format(policy.endDate, 'dd MMM, yyyy')}"></span>
												</td>
												<!--end::Qty=-->
												<!--begin::Price=-->
												<td class="text-end pe-0">
													<span class="fw-bolder" th:text="${policy.policyAssignments.size()} + ' service(s)'"></span>
												</td>
												<!--end::Price=-->
												<!--begin::Rating-->
												<td class="text-end pe-0">
													<span class="fw-bolder">
														<span class="text-info" th:text="${policy.totalRate} + '%'">12%</span>
														(for <span th:text="${policy.commissionTiers.size()}">5</span> levels)
													</span>
												</td>
												<!--end::Rating-->
												<!--begin::Status=-->
												<td class="text-end pe-0" data-order="Published">
													<!--begin::Badges-->
													<div class="badge badge-light-success" th:if="${policy.status eq policy.status.ACTIVE}" th:text="${policy.status}"></div>
													<div class="badge badge-light-danger" th:if="${policy.status eq policy.status.EXPIRED}" th:text="${policy.status}"></div>
													<div class="badge badge-light-warning" th:if="${policy.status eq policy.status.PENDING}" th:text="${policy.status}"></div>
													<!--end::Badges-->
												</td>
												<!--end::Status=-->
												<!--begin::Action=-->
												<td class="text-end">
													<a href="#" class="btn btn-bg-light btn-color-muted btn-active-color-primary btn-sm px-4 me-2" th:attr="data-bs-toggle='modal',data-bs-target=${'#kt_modal_view_users_' + policy.id}">View</a>
													<a th:href="@{/policy/edit/{id}(id=${policy.id})}" class="btn btn-bg-light btn-color-muted btn-active-color-primary btn-sm px-4" th:if="${policy.status eq policy.status.PENDING or policy.status eq policy.status.ACTIVE}">Edit</a>
												</td>
												<!--end::Action=-->
												<div class="modal fade" th:id="${'kt_modal_view_users_' + policy.id}"
													 tabindex="-1" aria-hidden="true">
													<!--begin::Modal dialog-->
													<div class="modal-dialog modal-dialog-centered mw-900px">
														<!--begin::Modal content-->
														<div class="modal-content">
															<!--begin::Modal header-->
															<div class="modal-header pb-0 border-0 justify-content-end">
																<!--begin::Close-->
																<div class="btn btn-sm btn-icon btn-active-color-primary"
																	 data-bs-dismiss="modal">
																	<!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
																	<span class="svg-icon svg-icon-1">
																	<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
																		 fill="none">
																		<rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1"
																			  transform="rotate(-45 6 17.3137)" fill="currentColor"/>
																		<rect x="7.41422" y="6" width="16" height="2" rx="1"
																			  transform="rotate(45 7.41422 6)" fill="currentColor"/>
																	</svg>
																</span>
																	<!--end::Svg Icon-->
																</div>
																<!--end::Close-->
															</div>
															<!--begin::Modal header-->
															<!--begin::Modal body-->
															<div class="modal-body scroll-y mx-5 mx-xl-18 pt-0 pb-15">
																<!--begin::Heading-->
																<div class="text-start mb-13">
																	<!--begin::Title-->
																	<h1 class="mb-3">Commission Policy</h1>
																	<!--end::Title-->
																	<!--begin::Description-->
																	<div class="text-muted fw-bold fs-5">Policy
																		<a class="link-primary fw-bolder" th:text="${policy.code}"></a>
																	</div>
																	<!--end::Description-->
																</div>
																<!--end::Heading-->
																<div class="d-flex justify-content-between gx-1">
																	<div class="border border-gray-300 border-dashed rounded py-3 px-4 mb-3" style="width: 23%">
																		<!--begin::Number-->
																		<div class="d-flex align-items-center">
																			<div class="fs-4 fw-bolder" th:text="${#temporals.format(policy.startDate, 'dd MMM, yyyy')}"></div>
																		</div>
																		<!--end::Number-->
																		<!--begin::Label-->
																		<div class="fw-bold fs-6 text-gray-400">Start Date</div>
																		<!--end::Label-->
																	</div>
																	<div class="border border-gray-300 border-dashed rounded py-3 px-4 mb-3" style="width: 23%">
																		<!--begin::Number-->
																		<div class="d-flex align-items-center">
																			<div class="fs-4 fw-bolder" th:text="${#temporals.format(policy.endDate, 'dd MMM, yyyy')}"></div>
																		</div>
																		<!--end::Number-->
																		<!--begin::Label-->
																		<div class="fw-bold fs-6 text-gray-400">End Date</div>
																		<!--end::Label-->
																	</div>
																	<div class="border border-gray-300 border-dashed rounded py-3 px-4 mb-3" style="width: 23%">
																		<!--begin::Number-->
																		<div class="d-flex align-items-center">
																			<div class="fs-4 fw-bolder" th:text="${policy.policyAssignments.size()} + ' service(s)'"></div>
																		</div>
																		<!--end::Number-->
																		<!--begin::Label-->
																		<div class="fw-bold fs-6 text-gray-400">Services Applied</div>
																		<!--end::Label-->
																	</div>
																	<div class="border border-gray-300 border-dashed rounded py-3 px-4 mb-3" style="width: 23%">
																		<!--begin::Number-->
																		<div class="d-flex align-items-center">
																			<div class="fs-4 fw-bolder" th:text="${policy.totalRate} + '%'"></div>
																		</div>
																		<!--end::Number-->
																		<!--begin::Label-->
																		<div class="fw-bold fs-6 text-gray-400">Total Rate</div>
																		<!--end::Label-->
																	</div>
																</div>


																<div class="mt-4 mb-3 border border-gray-300 border-dashed rounded py-3 px-4">
																	<h3 class="fw-bolder mb-2">Commission Rate:</h3>
																	<div class="d-flex justify-content-between align-items-center" th:each="tier : ${policy.commissionTiers}">
																		<a href="#" class="d-flex align-items-center p-3 rounded bg-state-light bg-state-opacity-50 mb-1" >
																			<!--begin::Avatar-->
																			<div class="symbol symbol-35px symbol-circle me-5">
																				<span class="symbol-label bg-light-info text-info fw-bold" th:text="${#numbers.formatInteger(tier.level, 2)}">01</span>
																			</div>
																			<!--end::Avatar-->
																			<!--begin::Info-->
																			<div class="fw-bold">
																				<span class="fs-6 text-gray-800 me-2" th:text="${'Upper level' + #numbers.formatInteger(tier.level, 2)}">Upper level 01</span>
																			</div>
																			<!--end::Info-->
																		</a>
																		<span class="text-success fs-7 fw-bolder" th:text="${#numbers.formatDecimal(tier.commissionRate, 2, 2) + '%'}">34%</span>
																	</div>

																</div>


																<!--begin::Users-->
																<div class="mb-15 pt-5">
																	<h3 class="fw-bolder mb-3">Services Applied:</h3>
																	<!--begin::List-->
																	<div class="mh-500px scroll-y me-n7 pe-7">
																		<!--begin::User-->
																		<div class="d-flex flex-stack py-5 border-bottom border-gray-300 border-bottom-dashed" th:each="service : ${policy.policyAssignments}">
																			<!--begin::Details-->
																			<div class="d-flex align-items-center">
																				<!--begin::Details-->
																				<div class="">
																					<!--begin::Name-->
																					<a href="#"
																					   class="d-flex align-items-center fs-5 fw-bolder text-dark text-hover-primary" th:text="${service.service.name}">
																						</a>
																					<!--end::Name-->
																					<!--begin::Email-->
																					<div class="fw-bold text-muted" th:text="${service.service.description}"></div>
																					<!--end::Email-->
																				</div>
																				<!--end::Details-->
																			</div>
																			<!--end::Details-->
																			<!--begin::Stats-->
																			<div class="d-flex">
																				<!--begin::Sales-->
																				<div class="text-end">
																					<div class="fs-5 fw-bolder text-dark" th:text="${#numbers.formatCurrency(service.service.basePrice)}"></div>
																				</div>
																				<!--end::Sales-->
																			</div>
																			<!--end::Stats-->
																		</div>
																		<!--end::User-->
																	</div>
																	<!--end::List-->
																</div>
																<!--end::Users-->
															</div>
															<!--end::Modal body-->
														</div>
														<!--end::Modal content-->
													</div>
													<!--end::Modal dialog-->
												</div>
											</tr>
											<!--end::Table row-->


											</tbody>
											<!--end::Table body-->
										</table>
										<!--end::Table-->
										<div class="row">
											<div class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start">
												<div class="dataTables_length">
													<label>
														<select class="form-select form-select-sm form-select-solid" id="size-select" th:attr="data-url=@{/policy(page=0)}">
															<option th:selected="${size == 5}" th:value="5">5</option>
															<option th:selected="${size == 10}" th:value="10">10</option>
															<option th:selected="${size == 25}" th:value="25">25</option>
															<option th:selected="${size == 50}" th:value="50">50</option>
														</select>
													</label>
												</div>
											</div>
											<div class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
												<div class="dataTables_paginate paging_simple_numbers">
													<ul class="pagination">
														<li class="paginate_button page-item previous disabled" th:if="${currentPage} > 0">
															<a th:href="@{/policy(page=${currentPage - 1}, size=${size})}" class="page-link">
																<i class="previous"></i>
															</a>
														</li>
														<li class="paginate_button page-item" th:classappend="${currentPage == i} ? 'active' : ''" th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
															<a class="page-link" th:href="@{/policy(page=${i}, size=${size})}"
															   th:text="${i + 1}">1</a>
														</li>
														<li class="paginate_button page-item next" th:if="${currentPage} < ${totalPages} - 1">
															<a class="page-link" th:href="@{/policy(page=${currentPage + 1}, size=${size})}"><i class="next"></i></a>
														</li>
													</ul>
												</div>
											</div>
										</div>
									</div>
									<!--end::Card body-->
								</div>
								<!--end::Products-->


								<div class="card card-flush mt-10">
									<!--begin::Card header-->
									<div class="card-header align-items-center py-5 gap-2 gap-md-5">
										<h3 class="card-title align-items-start flex-column">
											<span class="card-label fw-bolder fs-3 mb-1">Services & Policies Assignment</span>
										</h3>
									</div>
									<!--end::Card header-->
									<!--begin::Card body-->
									<div class="card-body pt-0">
										<div id="kt_docs_vistimeline_group" class="vis-timeline-custom"></div>
									</div>
									<!--end::Card body-->
								</div>

							</div>
							<!--end::Container-->
						</div>
						<!--end::Post-->
					</div>
					<!--end::Content-->
				</div>
				<!--end::Wrapper-->
			</div>
			<!--end::Page-->
		</div>
		<!--end::Root-->

		<!--end::Main-->

		<!--begin::Scrolltop-->
		<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
			<!--begin::Svg Icon | path: icons/duotune/arrows/arr066.svg-->
			<span class="svg-icon">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
					<rect opacity="0.5" x="13" y="6" width="13" height="2" rx="1" transform="rotate(90 13 6)" fill="currentColor" />
					<path d="M12.5657 8.56569L16.75 12.75C17.1642 13.1642 17.8358 13.1642 18.25 12.75C18.6642 12.3358 18.6642 11.6642 18.25 11.25L12.7071 5.70711C12.3166 5.31658 11.6834 5.31658 11.2929 5.70711L5.75 11.25C5.33579 11.6642 5.33579 12.3358 5.75 12.75C6.16421 13.1642 6.83579 13.1642 7.25 12.75L11.4343 8.56569C11.7467 8.25327 12.2533 8.25327 12.5657 8.56569Z" fill="currentColor" />
				</svg>
			</span>
			<!--end::Svg Icon-->
		</div>
		<!--end::Scrolltop-->
		<!--begin::Modals-->





		<!--end::Modals-->
		<!--begin::Javascript-->
		<script>var hostUrl = "/";</script>
		<!--begin::Global Javascript Bundle(used by all pages)-->
		<script th:src="@{/plugins/global/plugins.bundle.js}"></script>
		<script th:src="@{/js/scripts.bundle.js}"></script>
		<!--end::Global Javascript Bundle-->
		<!--begin::Page Vendors Javascript(used by this page)-->
		<script th:src="@{/plugins/custom/datatables/datatables.bundle.js}"></script>
		<script th:src="@{/plugins/custom/vis-timeline/vis-timeline.bundle.js}"></script>
		<!--end::Page Vendors Javascript-->
		<!--begin::Page Custom Javascript(used by this page)-->
		<script th:src="@{/js/widgets.bundle.js}"></script>
		<script th:src="@{/js/custom/widgets.js}"></script>
		<script th:src="@{/js/custom/apps/chat/chat.js}"></script>
		<script th:src="@{/js/custom/utilities/modals/upgrade-plan.js}"></script>
		<script th:src="@{/js/custom/utilities/modals/create-app.js}"></script>
		<script th:src="@{/js/custom/utilities/modals/users-search.js}"></script>

		<script>
			$(document).ready(function() {
				$('#size-select').on('change', function() {
					const newSize = $(this).val();
					const url = $(this).data('url') + `&size=${newSize}`;
					window.location.href = url;
				});
			});
		</script>

		<script th:inline="javascript">
			/*<![CDATA[*/
			// Generate HTML content
			const getContent = (policy) => {
				const startDate = new Date(policy.policy.startDate);
				const endDate = new Date(policy.policy.endDate);
				const star = startDate.toLocaleDateString("en-US");
				const end = endDate.toLocaleDateString("en-US");

				var item;
				switch (policy.policy.id % 10) {
					case 0:
					case 5:
						item = `<div class="alert alert-primary border-3" data-bs-toggle="modal" data-bs-target="#kt_modal_view_users_${policy.policy.id}">
    <div class="d-flex flex-column">
        <h4 class="mb-1 text-primary">${policy.policy.code}</h4>
        <div>${star} - ${end}</div>
        <span>Apply for ${policy.policy.maxReferralLevels} levels</span>
    </div>
</div>`;
						break;
					case 1:
					case 6:
						item = `<div class="alert alert-success border-3" data-bs-toggle="modal" data-bs-target="#kt_modal_view_users_${policy.policy.id}">
    <div class="d-flex flex-column">
        <h4 class="mb-1 text-success">${policy.policy.code}</h4>
        <div>${star} - ${end}</div>
        <span>Apply for ${policy.policy.maxReferralLevels} levels</span>
    </div>
</div>`;
						break;
					case 2:
					case 7:
						item = `<div class="alert alert-info border-3" data-bs-toggle="modal" data-bs-target="#kt_modal_view_users_${policy.policy.id}">
    <div class="d-flex flex-column">
        <h4 class="mb-1 text-info">${policy.policy.code}</h4>
        <div>${star} - ${end}</div>
        <span>Apply for ${policy.policy.maxReferralLevels} levels</span>
    </div>
</div>`;
						break;
					case 3:
					case 8:
						item = `<div class="alert alert-warning border-3" data-bs-toggle="modal" data-bs-target="#kt_modal_view_users_${policy.policy.id}">
    <div class="d-flex flex-column">
        <h4 class="mb-1 text-warning">${policy.policy.code}</h4>
        <div>${star} - ${end}</div>
        <span>Apply for ${policy.policy.maxReferralLevels} levels</span>
    </div>
</div>`;
						break;
					case 4:
					case 9:
						item = `<div class="alert alert-danger border-3" data-bs-toggle="modal" data-bs-target="#kt_modal_view_users_${policy.policy.id}">
    <div class="d-flex flex-column">
        <h4 class="mb-1 text-danger">${policy.policy.code}</h4>
        <div>${star} - ${end}</div>
        <span>Apply for ${policy.policy.maxReferralLevels} levels</span>
    </div>
</div>`;
						break;
					default:
						item = `<div class="alert alert-primary border-3" data-bs-toggle="modal" data-bs-target="#kt_modal_view_users_${policy.policy.id}">
    <div class="d-flex flex-column">
        <h4 class="mb-1 text-primary">${policy.policy.code}</h4>
        <div>${star} - ${end}</div>
        <span>Apply for ${policy.policy.maxReferralLevels} levels</span>
    </div>
</div>`;
				}
				return item;
			}

			const services = /*[[${services}]]*/;
			console.log(services);

			var now = Date.now();

			var options = {
				// stack: true,
				stack: false,
				maxHeight: 640,
				horizontalScroll: false,
				verticalScroll: true,
				zoomKey: "ctrlKey",
				start: Date.now() - 1000 * 60 * 60 * 24 * 60, // minus 60 days
				end: Date.now() + 1000 * 60 * 60 * 24 * 30, // plus 1 months aprox.
				orientation: {
					axis: "both",
					item: "top",
				},
				margin: {
					item: 20
				},

				xss: {
					disabled: !1,
					filterOptions: {
						whiteList: {
							div: ["class", "style", "data-bs-toggle", "data-bs-target"],
							h4: ["class", "style"],
							span: ["class", "style"],
							img: ["data-kt-timeline-avatar-src", "alt"],
							a: ["href", "class"]
						}
					}
				},
			};
			var groups = new vis.DataSet();
			var items = new vis.DataSet();

			var count = 300;

			for (const service of services) {
				groups.add({
					id: service.id,
					content: service.name,
					order: service.id,
				});

				for (const policy of service.policyAssignments) {
					items.add({
						id: policy.id,
						group: service.id,
						start: new Date(policy.policy.startDate),
						end: new Date(policy.policy.endDate),
						type: "range",
						content: getContent(policy),
					});
				}
			}

			// create a Timeline
			var container = document.getElementById("kt_docs_vistimeline_group");
			var timeline = new vis.Timeline(container, items, groups, options);
			//timeline = new vis.Timeline(container, null, options);


			/*]]>*/
		</script>
		<!--end::Page Custom Javascript-->
		<!--end::Javascript-->
	</body>
	<!--end::Body-->
</html>